const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/meditor-BizB4Nzy.js","assets/@vue-DuLrxf2X.js","assets/index-D69LMJuj.js","assets/vue-router-11agx4en.js","assets/nprogress-kPy6QMHr.js","assets/@kangc-gu18bvMu.js","assets/vue-DoXTYsZj.js","assets/@kangc-3hQqCbGp.css","assets/nprogress-IQvgPhqq.css","assets/element-plus-Ctj9zTtO.js","assets/lodash-es-CiJSjksT.js","assets/@vueuse-BuAFA7S7.js","assets/@element-plus-C3F0jtPG.js","assets/@popperjs-D9SI2xQl.js","assets/@ctrl-r5W6hzzQ.js","assets/dayjs-B2SHKluj.js","assets/async-validator-DKvM95Vc.js","assets/memoize-one-BdPwpGay.js","assets/normalize-wheel-es-B6fDCfyv.js","assets/@floating-ui-8uccrNCM.js","assets/element-plus-rtE9mq23.css","assets/pinia-SNm9yluJ.js","assets/vue-demi-Dq6ymT-8.js","assets/prismjs-3VRiJhH1.js","assets/highlight.js-B4C3kCeh.js","assets/index-iDc_Xa7b.css","assets/meditor-CGULkjl_.css"])))=>i.map(i=>d[i]);
import{_ as h,a as Z}from"./index-D69LMJuj.js";import{u as $}from"./index-BZ0-GGld.js";import{s as q}from"./pinia-SNm9yluJ.js";import{u as z}from"./ws-C1Y02uT6.js";import{E as F}from"./element-plus-Ctj9zTtO.js";import{b as C,Z as I,e as G,ai as n,o as r,c as p,U as t,O as l,S as u,u as J,M as K,R as Q,a as d,T as S,F as X,aV as Y,n as ee}from"./@vue-DuLrxf2X.js";import"./vue-router-11agx4en.js";import"./nprogress-kPy6QMHr.js";import"./@kangc-gu18bvMu.js";import"./vue-DoXTYsZj.js";import"./@element-plus-C3F0jtPG.js";import"./prismjs-3VRiJhH1.js";import"./highlight.js-B4C3kCeh.js";import"./lodash-es-CiJSjksT.js";import"./@vueuse-BuAFA7S7.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-B2SHKluj.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-8uccrNCM.js";import"./vue-demi-Dq6ymT-8.js";import"./request-KPIbsDrP.js";import"./axios-CCb-kr4I.js";const te={key:0,class:"flex items-center gap-2"},le={key:1},oe={key:0},ae={key:1,class:"content-box p-4 flex flex-col gap-2"},ne=["innerHTML"],se={key:0,class:"dialog-footer"},ie={key:1,class:"dialog-footer"},re={__name:"authoritativeRelease",setup(ue){const T=Y(()=>Z(()=>import("./meditor-BizB4Nzy.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]))),f=C(!0),b=z(),{ws:k,roomId:V,contentShow:A,articalInfo:E}=q(b),w=$(),o=I(E.value),_=C(!1),M=()=>{_.value=!0},s=I({value:0,flag:!1,message:""}),v=C(""),N=async()=>{s.flag=!0;const{status_code:c}=await w.publish({factor:o.factor,media_type:o.media_type,room_id:V.value});if(c===200){f.value=!0;let e=setInterval(()=>{s.value<90&&(s.value=s.value+1)},200);try{const{data:a}=await w.getArticle(V.value),g=Object.keys(a[0]);s.value=100,v.value=a[0][g[0]].replace(/\n/g,"<br>").replace(/\*/g,"")}catch{F.warning("获取文章失败")}finally{f.value=!1,clearInterval(e)}}},O=()=>{_.value=!1,ee(()=>{v.value="",Object.assign(s,{value:0,flag:!1,message:""})})},R=()=>{o.content=v.value.replace(/<br>/g,`
`)},U=async()=>{let c=o.content.replace(/\n/g,"");const{message:e,status_code:a}=await w.publishContent({room_id:V.value,news_content:A.value,evalua_content:c});a===200&&(F.success(e),k.value&&k.value.readyState===WebSocket.OPEN&&(k.value.close(1e3,"正常关闭"),b.setWs(null)))};return G(()=>o,c=>{b.setArticalInfo(c)},{deep:!0}),(c,e)=>{const a=n("el-option"),g=n("el-select"),y=n("el-form-item"),m=n("el-button"),W=n("el-form"),x=n("el-col"),B=n("el-row"),D=n("WarningFilled"),L=n("el-icon"),P=n("el-progress"),j=n("el-scrollbar"),H=n("el-dialog");return r(),p(X,null,[t(B,{class:"p-1 pb-4"},{default:l(()=>[t(x,{span:24},{default:l(()=>[t(W,{inline:!0,class:"demo-form-inline"},{default:l(()=>[t(y,{label:"发布要素"},{default:l(()=>[t(g,{modelValue:o.factor,"onUpdate:modelValue":e[0]||(e[0]=i=>o.factor=i),placeholder:"请选择发布内容"},{default:l(()=>[t(a,{label:"讲事实",value:"讲事实"}),t(a,{label:"讲原因",value:"讲原因"}),t(a,{label:"讲措施",value:"讲措施"}),t(a,{label:"讲态度",value:"讲态度"})]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"权威机构"},{default:l(()=>[t(g,{modelValue:o.media_type,"onUpdate:modelValue":e[1]||(e[1]=i=>o.media_type=i),placeholder:"请选择权威机构"},{default:l(()=>[t(a,{label:"官方媒体平台",value:"官方媒体平台"}),t(a,{label:"新闻平台",value:"新闻平台"}),t(a,{label:"学校官微",value:"学校官微"})]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:l(()=>[t(m,{type:"primary",color:"#0058F9",onClick:M},{default:l(()=>e[5]||(e[5]=[u("查看模板")])),_:1})]),_:1}),t(y,{style:{position:"absolute",right:"0px"}},{default:l(()=>[t(m,{type:"primary",color:"#0058F9",onClick:U},{default:l(()=>e[6]||(e[6]=[u("发布")])),_:1})]),_:1})]),_:1})]),_:1}),t(x,{span:24},{default:l(()=>[t(J(T),{modelValue:o.content,"onUpdate:modelValue":e[2]||(e[2]=i=>o.content=i),height:430},null,8,["modelValue"])]),_:1})]),_:1}),t(H,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=i=>_.value=i),title:"生成模版",width:"700","align-center":"","close-on-click-modal":!1,"show-close":!1},{footer:l(()=>[s.flag?(r(),p("div",ie,[f.value?Q("",!0):(r(),K(m,{key:0,onClick:R,color:"#0058F9",plain:""},{default:l(()=>e[12]||(e[12]=[u(" 使用模版 ")])),_:1})),t(m,{onClick:O,loading:f.value,color:"#0058F9"},{default:l(()=>e[13]||(e[13]=[u(" 完成 ")])),_:1},8,["loading"])])):(r(),p("div",se,[t(m,{onClick:e[3]||(e[3]=i=>_.value=!1),color:"#0058F9",plain:""},{default:l(()=>e[10]||(e[10]=[u(" 取消 ")])),_:1}),t(m,{type:"primary",onClick:N,color:"#0058F9"},{default:l(()=>e[11]||(e[11]=[u(" 确认")])),_:1})]))]),default:l(()=>[d("div",null,[s.flag?(r(),p("div",le,[f.value?(r(),p("div",oe,[t(P,{"text-inside":!0,"stroke-width":20,percentage:s.value},null,8,["percentage"])])):(r(),p("div",ae,[t(j,{height:500,class:"pr-2"},{default:l(()=>[d("div",null,[e[8]||(e[8]=d("span",null," 权威机构： ",-1)),u(" "+S(o.media_type),1)]),d("div",null,[e[9]||(e[9]=d("span",null," 发布要素： ",-1)),u(" "+S(o.factor),1)]),d("div",{innerHTML:v.value},null,8,ne)]),_:1})]))])):(r(),p("div",te,[t(L,{style:{color:"#e6a23c"}},{default:l(()=>[t(D)]),_:1}),e[7]||(e[7]=d("span",null,"生成模版信息所需时间较长，请确认是否生成",-1))]))])]),_:1},8,["modelValue"])],64)}}},Ue=h(re,[["__scopeId","data-v-2e7c0f23"]]);export{Ue as default};
