import{b as u,Z as U,j as $,A as G,M,O as o,n as E,ai as n,o as h,U as t,a as _,S as d,c as J,a8 as Q,T as X,F as ee,a9 as le,a2 as oe}from"./@vue-DuLrxf2X.js";import{u as te}from"./vue-router-11agx4en.js";import{u as ae}from"./login-BWe_jNdb.js";import{_ as se}from"./index-D69LMJuj.js";import{E as ne}from"./element-plus-Ctj9zTtO.js";import"./request-KPIbsDrP.js";import"./axios-CCb-kr4I.js";import"./nprogress-kPy6QMHr.js";import"./@kangc-gu18bvMu.js";import"./vue-DoXTYsZj.js";import"./@element-plus-C3F0jtPG.js";import"./pinia-SNm9yluJ.js";import"./vue-demi-Dq6ymT-8.js";import"./prismjs-3VRiJhH1.js";import"./highlight.js-B4C3kCeh.js";import"./lodash-es-CiJSjksT.js";import"./@vueuse-BuAFA7S7.js";import"./@popperjs-D9SI2xQl.js";import"./@ctrl-r5W6hzzQ.js";import"./dayjs-B2SHKluj.js";import"./async-validator-DKvM95Vc.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui-8uccrNCM.js";const re={style:{padding:"30px"}},ue={style:{width:"300px"}},ie={class:"flex justify-center font-sty"},V=20,de={__name:"register",setup(pe){const T=u(null),z=U({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],company:[{required:!0,message:"请输入学校",trigger:"change"}],department:[{required:!0,message:"请输入部门",trigger:"change"}]}),L=ae(),R=te(),m=u(!1),a=U({username:"",password:"",company:"",department:"",is_admin:!1}),j=async l=>{l&&await l.validate(async(e,v)=>{if(e){m.value=!0;try{const{status_code:r}=await L.register(a);r===200&&ne.success("注册成功"),I()}catch{m.value=!1}}else console.log("error submit!",v)})},S=async()=>{j(T.value),m.value=!1},I=()=>{q(),m.value=!1},q=()=>{R.push({path:"/login"})},k=l=>{l.keyCode===13&&S()},c=u([]),g=u(0),p=u(1),y=u([]),i=u(),w=u(0),f=u([]),N=async()=>{const{data:l}=await L.getSchoolList();E(()=>{c.value=l,g.value=c.value.length}),x()},x=()=>{const l=(p.value-1)*V;y.value=f.value.slice(l,l+V),O()},O=()=>{if(a.company&&!y.value.find(l=>l==a.company)){let l=c.value.find(e=>e==a.company);y.value.push(l)}},A=l=>{f.value=c.value.filter(e=>e.includes(l)),p.value=1,g.value=Math.ceil(f.value.length/V),x()},D=l=>{l?(w.value=0,E(()=>{var r;const e=document.querySelector(".el-select-dropdown .el-select-dropdown__wrap");i.value=e,document.querySelector("ul.el-scrollbar__view").clientHeight>e.clientHeight&&((r=i.value)==null||r.addEventListener("wheel",H))})):(p.value=1,g.value=Math.ceil(f.value.length/V),f.value=c.value)},H=l=>{l.deltaY>0?w.value!=i.value.scrollTop?w.value=i.value.scrollTop:w.value==i.value.scrollTop&&p.value<g.value&&(p.value+=1,i.value.scrollTop=10):l.deltaY<0&&i.value.scrollTop==0&&p.value>1&&(p.value-=1,i.value.scrollTop=10,setTimeout(()=>{},500)),x()};return $(()=>{window.addEventListener("keydown",k),N()}),G(()=>{window.removeEventListener("keydown",k,!1)}),(l,e)=>{const v=n("el-input"),r=n("el-form-item"),b=n("el-option"),B=n("el-select"),C=n("el-radio"),K=n("el-radio-group"),Y=n("el-form"),F=n("el-button"),P=n("el-card"),W=n("el-col"),Z=n("el-row");return h(),M(Z,null,{default:o(()=>[t(W,{span:12,offset:12,style:{height:"100vh"},class:"flex flex-col items-center justify-center"},{default:o(()=>[t(P,{class:"box-card"},{footer:o(()=>[_("div",ie,[e[14]||(e[14]=d(" 已有账号？ ")),t(F,{link:"",type:"primary",onClick:q,style:{color:"#0058F9"}},{default:o(()=>e[13]||(e[13]=[d("立即登录")])),_:1})])]),default:o(()=>[_("div",re,[e[12]||(e[12]=_("div",{class:"welc"},"欢迎注册",-1)),t(Y,{model:a,"label-position":"top",rules:z,ref_key:"ruleFormRef",ref:T,"hide-required-asterisk":!0},{default:o(()=>[t(r,{label:"用户名",prop:"username"},{default:o(()=>[t(v,{id:"username",modelValue:a.username,"onUpdate:modelValue":e[0]||(e[0]=s=>a.username=s),size:"large",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),t(r,{label:"密码",prop:"password"},{default:o(()=>[t(v,{id:"password",type:"password",modelValue:a.password,"onUpdate:modelValue":e[1]||(e[1]=s=>a.password=s),size:"large",placeholder:"请输入密码",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(r,{label:"学校",prop:"company"},{default:o(()=>[t(B,{modelValue:a.company,"onUpdate:modelValue":e[2]||(e[2]=s=>a.company=s),placeholder:"请选择学校",filterable:"",onVisibleChange:D,"filter-method":A},{default:o(()=>[(h(!0),J(ee,null,Q(y.value,s=>(h(),M(b,{key:s,label:s,value:s},{default:o(()=>[_("div",ue,X(s),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"部门",prop:"department"},{default:o(()=>[t(B,{modelValue:a.department,"onUpdate:modelValue":e[3]||(e[3]=s=>a.department=s),placeholder:"请选择部门",filterable:""},{default:o(()=>[t(b,{value:"宣传部"},{default:o(()=>e[6]||(e[6]=[d("宣传部")])),_:1}),t(b,{value:"组织部"},{default:o(()=>e[7]||(e[7]=[d("组织部")])),_:1}),t(b,{value:"其他"},{default:o(()=>e[8]||(e[8]=[d("其他")])),_:1})]),_:1},8,["modelValue"])]),_:1}),t(r,null,{default:o(()=>[t(K,{modelValue:a.is_admin,"onUpdate:modelValue":e[4]||(e[4]=s=>a.is_admin=s)},{default:o(()=>[t(C,{value:!1,size:"large"},{default:o(()=>e[9]||(e[9]=[d("普通用户")])),_:1}),t(C,{value:!0,size:"large"},{default:o(()=>e[10]||(e[10]=[d("管理员")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),_("div",null,[t(F,{id:"loginBtn",class:"login-form__button",loading:m.value,type:"primary",onKeydown:e[5]||(e[5]=le(s=>k(),["enter"])),onClick:oe(S,["prevent"])},{default:o(()=>e[11]||(e[11]=[d("注册")])),_:1},8,["loading"])])])]),_:1})]),_:1})]),_:1})}}},Re=se(de,[["__scopeId","data-v-2da7e504"]]);export{Re as default};
